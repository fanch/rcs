pkg=cargo
ver=0.17.0
rel=1
sum="Rust package manager"
lic="APACHE, MIT, custom"
url=http://crates.io
dep=(curl rust)
mkd=(cmake git)
opt=(!emptydirs)
src=(git+https://github.com/rust-lang/cargo.git#tag=$ver)

build() {
    git submodule update --init --recursive
    sed 's^share/doc^share/licenses^g' -i Makefile.in

    ./configure --prefix=/usr \
                --enable-optimize
    make
}

package() {
    make DESTDIR="$pkgdir" install

    # Remove files that contains references to $srcdir or $pkgdir,
    # or that conflicts with the rust package.
    rm -f $pkgdir/usr/lib/rustlib/{install.log,manifest-cargo,uninstall.sh}

    install -d $pkgdir/usr/share/bash-completion/completions
    mv $pkgdir/usr/etc/bash_completion.d/cargo \
        $pkgdir/usr/share/bash-completion/completions/cargo
}
