pkg=iptables
ver=1.6.1
rel=1
sum="Linux kernel packet control tool"
lic=GPL2
url=http://www.netfilter.org/projects/iptables/index.html
dep=(bash libnftnl)
src=(http://www.netfilter.org/projects/iptables/files/$pkg-$ver.tar.bz2)
sha=(0fc2d7bd5d7be11311726466789d4c65fb4c8e096c9182b56ce97440864f0cf5)

build() {
    # use system one
    rm include/linux/types.h

    ./configure --prefix=/usr \
                --sysconfdir=/etc \
                --sbindir=/usr/bin \
                --enable-devel \
                --enable-shared
    make
}

package() {
    make DESTDIR=$pkgdir install

    install -D -m644 $rcsdir/empty.rules $pkgdir/etc/iptables/empty.rules
    install -D -m644 $rcsdir/simple_firewall.rules $pkgdir/etc/iptables/simple_firewall.rules

    mkdir -p $pkgdir/var/lib/{iptables,ip6tables}
    install -m644 $rcsdir/empty-{filter,mangle,nat,raw,security}.rules $pkgdir/var/lib/iptables
    install -m644 $rcsdir/empty-{filter,mangle,nat,raw,security}.rules $pkgdir/var/lib/ip6tables

    # install systemd files
    install -Dm644 $rcsdir/iptables.service $pkgdir/usr/lib/systemd/system/iptables.service
    install -Dm644 $rcsdir/ip6tables.service $pkgdir/usr/lib/systemd/system/ip6tables.service
    install -Dm755 $rcsdir/iptables-flush $pkgdir/usr/lib/systemd/scripts/iptables-flush
}
