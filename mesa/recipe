pkg=mesa
ver=12.0.99
rel=1
sum="an open-source implementation of the OpenGL specification"
lic=custom
url=http://mesa3d.sourceforge.net
dep=(elfutils expat libdrm libomxil-bellagio libxext libxdamage libxshmfence llvm systemd wayland libclc libgcrypt)
mkd=(glproto dri2proto dri3proto presentproto libvdpau libva)
#src=(ftp://ftp.freedesktop.org/pub/mesa/$ver/mesa-$ver.tar.xz)
#sha=(bab24fb79f78c876073527f515ed871fc9c81d816f66c8a0b051d8d653896389)
src=(git://anongit.freedesktop.org/mesa/mesa#branch=master)

build() {
	# Now mesa checks for libpthread-stubs - so remove the check
	#patch -Np1 -i $rcsdir/remove-libpthread-stubs.patch

	#autoreconf -fiv
    #./configure --prefix=/usr \

    ./autogen.sh --prefix=/usr \
                --sysconfdir=/etc \
                --with-gallium-drivers=r300,r600,radeonsi,nouveau,svga,swrast,virgl \
                --with-dri-drivers=i915,i965,r200,radeon,nouveau,swrast \
                --with-egl-platforms=x11,drm,wayland \
                --with-vulkan-drivers=intel \
                --with-clang-libdir=/usr/lib \
                --with-sha1=libgcrypt \
                --enable-gallium-llvm \
                --enable-llvm-shared-libs \
                --enable-shared-glapi \
                --enable-egl \
                --enable-gles1 \
                --enable-gles2 \
                --enable-gbm \
                --enable-dri \
                --enable-osmesa \
                --enable-texture-float \
                --enable-xa \
                --enable-vdpau \
                --enable-omx \
                --enable-nine \
                --enable-opencl \
                --enable-opencl-icd
    make
}

package() {
    make DESTDIR=$pkgdir install

    install -Dm644 $rcsdir/LICENSE $pkgdir/usr/share/licenses/$pkg/LICENSE
}
