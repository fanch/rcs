pkg=networkmanager
ver=1.4.2
rel=1
sum="Network Management daemon"
lic="GPL2, LGPL2.1"
url=http://www.gnome.org/projects/NetworkManager
dep=(libndp libsoup modemmanager polkit iproute2 libgudev wpa_supplicant dbus-glib util-linux nss dhcp)
mkd=(gobject-introspection intltool iptables gtk-doc vala ppp perl-yaml)
bak=(/etc/NetworkManager/NetworkManager.conf)
src=(https://download.gnome.org/sources/NetworkManager/${ver:0:3}/NetworkManager-$ver.tar.xz)
sha=(a864e347ddf6da8dabd40e0185b8c10a655d4a94b45cbaa2b3bb4b5e8360d204)
_pppver=2.4.7

build() {
    2to3 -w libnm src tools

    NOCONFIGURE=1 ./autogen.sh

    ./configure --prefix=/usr \
                --sysconfdir=/etc \
                --localstatedir=/var \
                --sbindir=/usr/bin \
                --with-crypto=nss \
                --with-dhclient=/usr/bin/dhclient \
                --without-dhcpcd \
                --with-dnsmasq=/usr/bin/dnsmasq \
                --with-iptables=/usr/bin/iptables \
                --with-systemdsystemunitdir=/usr/lib/systemd/system \
                --with-udev-dir=/usr/lib/udev \
                --with-resolvconf=/usr/bin/resolvconf \
                --with-pppd=/usr/bin/pppd \
                --with-pppd-plugin-dir=/usr/lib/pppd/$_pppver \
                --with-session-tracking=systemd \
                --with-modem-manager-1 \
                --disable-static \
                --enable-more-warnings=no \
                --disable-wimax \
                --enable-modify-system \
                --enable-doc \
                --enable-gtk-doc
    make
}

package() {
    make DESTDIR=$pkgdir install

    install -m644 $rcsdir/NetworkManager.conf $pkgdir/etc/NetworkManager
    install -m755 -d $pkgdir/etc/NetworkManager/dnsmasq.d
    rm -r $pkgdir/var/run
}
