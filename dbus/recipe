pkg=dbus
ver=1.10.10
rel=1
sum="Freedesktop.org message bus system"
lic="custom, GPL"
url=http://www.freedesktop.org/Software/dbus
dep=(expat systemd)
src=(http://dbus.freedesktop.org/releases/$pkg/$pkg-$ver.tar.gz)
sha=(9d8f1d069ab4d1a0255d7b400ea3bcef4430c42e729b1012abb2890e3f739a43)

build() {
    patch -Np1 -i $rcsdir/0001-user-dbus.socket-Remove-Install-Also-dbus.service.patch
    autoreconf -fvi

    ./configure --prefix=/usr \
                --sysconfdir=/etc \
                --localstatedir=/var \
                --with-system-socket=/run/dbus/system_bus_socket \
                --with-system-pid-file=/run/dbus/pid \
                --with-dbus-user=dbus \
                --with-systemdsystemunitdir=/usr/lib/systemd/system \
                --enable-systemd \
                --enable-user-session \
                --enable-inotify \
                --disable-verbose-mode \
                --disable-static
    make
}

package() {
    make DESTDIR=$pkgdir install

    rm -rf $pkgdir/var/run

    rm $pkgdir/usr/lib/systemd/user/sockets.target.wants/dbus.socket
    rmdir $pkgdir/usr/lib/systemd/user/sockets.target.wants
    
    install -Dm644 COPYING $pkgdir/usr/share/licenses/$pkg/COPYING
}
