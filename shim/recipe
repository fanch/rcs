pkg=shim
ver=11
rel=1
sum="Simple bootloader for x86_64 UEFI Secure Boot"
lic=GPL
url=https://github.com/rhinstaller/shim
dep=(pesign dosfstools efivar efibootmgr)
mkd=(gnu-efi)
opt=(!strip)
src=(https://github.com/rhinstaller/$pkg/releases/download/$ver/$pkg-$ver.tar.bz2)
sha=(944b6ceddb8dea736f0ff3520406c1a16ae63af77546e7dbed84b1dec424e131)

build() {
    unset CFLAGS
    unset CPPFLAGS
    unset CXXFLAGS
    unset LDFLAGS
    unset MAKEFLAGS

    make
}

package() {
    install -d -m0755 $pkgdir/usr/lib/shim
    install -m0644 shim.efi.signed $pkgdir/usr/lib/shim/shim.efi
    install -m0644 MokManager.efi.signed $pkgdir/usr/lib/shim/MokManager.efi
    install -m0644 fallback.efi.signed $pkgdir/usr/lib/shim/fallback.efi

    install -d -m0755 $pkgdir/boot/efi/EFI/gnurama
    install -m0644 shim.efi.signed $pkgdir/boot/efi/EFI/gnurama/bootx64.efi
}
