pkg=handbrake
ver=1.0.1
rel=1
sum="Multithreaded video transcoder"
lic=GPL
url=https://handbrake.fr
dep=(bzip2 gcc-libs gst-plugins-base libnotify dbus-glib fribidi libass lame gtk3 fontconfig freetype libxml2 libogg libvorbis libtheora libsamplerate libbluray ffmpeg x264 x265 libvpx jansson libdvdread librsvg libgudev desktop-file-utils hicolor-icon-theme)
mkd=(intltool python yasm cmake)
src=(https://handbrake.fr/mirror/HandBrake-$ver.tar.bz2)
sha=(af4badcdf56465abc798e5e11fe0e437e23ea89bbee20798408980a34c4d5876)

build() {
    # https://bugs.gentoo.org/show_bug.cgi?id=552792
    patch -Np1 -i $rcsdir/handbrake-fix-missing-x265-link-flag.patch

    patch -Np1 -i $rcsdir/HandBrake-no_clip_id.patch

    for _lib in ffmpeg x265 libbluray libvpx libdvdread; do
        sed -i "/MODULES += contrib\/$_lib/d" make/include/main.defs
    done

    ./configure --prefix=/usr \
                --force \
                --disable-gtk-update-checks
    make -C build
}

package() {
    make -C build DESTDIR=$pkgdir install
}
