pkg=handbrake
ver=1.0.0
rel=1
sum="Multithreaded video transcoder"
lic=GPL
url=https://handbrake.fr
dep=(bzip2 gcc-libs gst-plugins-base libnotify dbus-glib fribidi libass lame gtk3 fontconfig freetype libxml2 libogg libvorbis libtheora libsamplerate libbluray x264 libdvdread librsvg libgudev desktop-file-utils hicolor-icon-theme)
mkd=(intltool python yasm cmake)
src=(https://handbrake.fr/mirror/HandBrake-$ver.tar.bz2)
sha=(15fb4593c70d75621212e4499f018c3c93d7ce39f1083bf527d4616ded0044c5)

build() {
    patch -Np1 -i $rcsdir/HandBrake-no_clip_id.patch

    # Use more system libs
    # We had ffmpeg here as well but it broke PGS subtitle processing
    # https://forum.handbrake.fr/viewtopic.php?f=13&t=27581
    sed -i \
        -e '/MODULES += contrib\/libbluray/d' \
        -e '/MODULES += contrib\/libdvdread/d' \
        make/include/main.defs

    ./configure --prefix=/usr \
                --force \
                --disable-gtk-update-checks
    make -C build
}

package() {
    make -C build DESTDIR=$pkgdir install
}
